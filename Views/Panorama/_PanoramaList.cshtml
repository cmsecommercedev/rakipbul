@using Rakipbul.ViewModels
@model PanoramaListViewModel

<div class="bg-white p-4 rounded-xl shadow-lg border border-gray-700 relative">
    <div id="loading" class="hidden absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50">
        <div class="animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"></div>
    </div>
    <!-- FILTER HEADER -->
    <form id="panorama-filter-form" method="get"
          class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">

        <!-- Lig -->
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Lig</label>
            <select name="LeagueId" class="w-full border border-gray-700 bg-gray-800 text-gray-200 rounded-lg px-3 py-2">
                <option value="">Tümü</option>
                @foreach (var l in Model.Leagues)
                {
                    <option value="@l.Id" selected="@(Model.Filter.LeagueId == l.Id)">
                        @l.Name
                    </option>
                }
            </select>
        </div>

        <!-- Sezon -->
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Sezon</label>
            <select name="Season" class="w-full border border-gray-700 bg-gray-800 text-gray-200 rounded-lg px-3 py-2">
                <option value="">Tümü</option>
                @foreach (var s in Model.Seasons)
                {
                    <option value="@s.Fullname" selected="@(Model.Filter.Season == s.Fullname)">
                        @s.Fullname (@s.Year)
                    </option>
                }
            </select>
        </div>

        <!-- Tarih Aralığı -->
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Başlangıç</label>
            <input type="date" name="StartDate"
                   value="@Model.Filter.StartDate?.ToString("yyyy-MM-dd")"
                   class="w-full border border-gray-700 bg-gray-800 text-gray-200 rounded-lg px-3 py-2" />
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Bitiş</label>
            <input type="date" name="EndDate"
                   value="@Model.Filter.EndDate?.ToString("yyyy-MM-dd")"
                   class="w-full border border-gray-700 bg-gray-800 text-gray-200 rounded-lg px-3 py-2" />
        </div>

        <!-- Search Button -->
        <div class="md:col-span-4 flex justify-end">
            <button type="submit"
                    class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition shadow">
                Ara
            </button>
        </div>
    </form>


    <!-- RESULTS LIST -->
    <div class="space-y-4">
        @if (Model.Items.Any())
        {
            @foreach (var item in Model.Items)
            {
                <div class="p-4 bg-white rounded-lg border border-gray-700 shadow-sm flex justify-between items-center">

                    <!-- LEFT CONTENT -->
                    <div>
                        <div class="font-semibold text-lg text-gray-100">@item.Title</div>
                        <div class="text-sm text-gray-400">
                            Lig: @item.LeagueName
                        </div>

                        <div class="text-xs text-gray-500 mt-1">
                            @item.StartDate?.ToString("dd.MM.yyyy") - @item.EndDate?.ToString("dd.MM.yyyy")
                        </div>

                        @if (!string.IsNullOrEmpty(item.PlayerName))
                        {
                            <div class="text-sm text-emerald-400 mt-1">
                                Golü Atan Oyuncu: @item.PlayerName
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(item.YoutubeEmbedLink))
                        {
                            <button type="button"
                                    x-on:click="openVideo('@item.YoutubeEmbedLink.Replace("'", "\\'")')"
                                    class="text-blue-400 hover:text-blue-300 text-sm mt-2 underline">
                                Videoyu Aç
                            </button>

                        }
                    </div>

                    <!-- RIGHT ACTIONS -->
                    <div>
                        <div x-data="{ deleteOpen:false }">

                            <!-- Sil butonu -->
                            <button type="button"
                                    @@click ="deleteOpen = true"
                                    class="bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700 shadow">
                                Sil
                            </button>

                            <!-- Silme onay modali -->
                            <div x-show="deleteOpen"
                                 x-transition.opacity.duration.200ms
                                 class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm"
                                 x-cloak>

                                <div x-transition.scale.origin.center
                                     class="bg-gray-900 border border-gray-700 rounded-lg p-6 w-80 shadow-xl">

                                    <h2 class="text-lg font-semibold text-gray-100 mb-2">
                                        Kaydı Sil
                                    </h2>

                                    <p class="text-gray-300 mb-4 text-sm">
                                        Bu panorama kaydını silmek istediğinize emin misiniz?
                                    </p>

                                    <div class="flex justify-end gap-3">
                                        <button @@click ="deleteOpen = false"
                                                class="px-4 py-2 rounded bg-gray-700 text-gray-200 hover:bg-gray-600">
                                            Vazgeç
                                        </button>

                                        <form method="post" asp-action="DeletePanorama" asp-route-id="@item.Id">
                                            <button type="submit"
                                                    class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700">
                                                Evet, Sil
                                            </button>
                                        </form>
                                    </div>

                                </div>
                            </div>


                        </div>

                    </div>

                </div>
            }
        }
        else
        {
            <div class="text-center text-gray-400 py-8">
                Sonuç bulunamadı.
            </div>
        }
    </div>

</div>


<!-- VIDEO MODAL -->
<div x-data="videoModal()" x-show="isOpen"
     class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm"
     x-cloak>

    <div class="bg-gray-900 w-full max-w-3xl rounded-xl shadow-lg relative p-4 border border-gray-700">

        <button class="absolute top-2 right-2 text-gray-300 font-bold text-xl"
                @@click ="close()">
            ✕
        </button>

        <div class="relative w-full" style="padding-top: 56.25%;">
            <iframe x-bind:src="embedUrl"
                    frameborder="0"
                    allowfullscreen
                    class="absolute inset-0 w-full h-full rounded-lg">
            </iframe>
        </div>

    </div>
</div>
