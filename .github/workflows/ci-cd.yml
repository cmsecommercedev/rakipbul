name: CI/CD Pipeline (Test & Master)

on:
  push:
    branches:
      - test
      - master

jobs:
  build:
    runs-on: ${{ github.ref == 'refs/heads/test' && 'TestRunner' || 'ProdRunner' }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Restore dependencies
        run: dotnet restore

      - name: Build
        run: dotnet build --configuration Release

      - name: Run tests
        run: dotnet test --no-build --verbosity normal

      - name: Publish
        run: dotnet publish -c Release -o ./publish

      # ðŸ§ª Test ortamÄ±na deploy
      - name: Deploy to Test
        if: github.ref == 'refs/heads/test'
        run: |
          echo "Deploying to TEST environment..."
          robocopy .\publish "C:\ftpserver\rakipbultest_runner" /E /MIR
          echo "âœ… Test deployment completed."

      # ðŸš€ Production (Master) ortamÄ±na deploy
      - name: Deploy to Production
        if: github.ref == 'refs/heads/master'
        run: |
          echo "Deploying to MASTER environment..."
          robocopy .\publish "C:\ftpserver\rakipbul_runner" /E /MIR
          echo "âœ… Master deployment completed."
